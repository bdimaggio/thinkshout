<!DOCTYPE html>
<!--[if IE 8]>         <html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <title>A mime is a terrible thing to waste | ThinkShout</title>

  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, minimum-scale=0.5 maximum-scale=1.0">
  <meta name="format-detection" content="telephone=no">

  
  <meta name="description" content="One of the first projects I am working on here at ThinkShout requires full-text search of file attachments.">

  <!-- Social Media Metatags -->
  
  <meta property="og:image" content="https://thinkshout.com/assets/images/ts_icon.jpg">
  <meta name="twitter:image" content="https://thinkshout.com/assets/images/ts_icon.jpg">
  

  
  <meta name="keywords" content="Apache Solr, Drupal Planet, Facet API">

  <!-- Fonts -->
  <link rel="stylesheet" type="text/css" href="//cloud.typography.com/6630094/7238952/css/fonts.css" />
  <link rel="stylesheet" type="text/css" href="/assets/fonts/MyFontsWebfontsKit.css" />

  <link rel="shortcut icon" href="/assets/images/assets/favicon.ico" type="image/vnd.microsoft.icon" />

  <!-- Normalize CSS -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/3.0.3/normalize.min.css" media="screen" title="no title" />

  <!-- Custom CSS -->
  <link rel="stylesheet" href="/assets/css/style.css?v=2018-06-11.11.49.44" />

  <!-- RSS feed -->
  <link rel="alternate" type="application/rss+xml" title="ThinkShout Feed" href="/rss.xml" />
</head>
<body class="blog-post">

  <!-- Header -->
  <header>
  <div class="container">
    <div class="header-logo">
      <a href="/">
        <img src="/assets/images/ts_redesign/ts-logo-full.png" alt="ThinkShout logo" />
      </a>
    </div>

    <a class="mobile-menu-icon">
      <div>
        <span aria-hidden="false">Menu</span>
      </div>
    </a>

		<nav>
			<ul class="main-menu">
        
          
            <li><a href="/work/">Our Work</a></li>
          
        
          
            <li><a href="/services/">Services</a></li>
          
        
          
            <li><a href="/values/">Values</a></li>
          
        
          
            <li><a href="/team/">Team</a></li>
          
        
          
            <li><a href="/blog/">Blog</a></li>
          
        
          
        
          
        
			</ul>
		</nav>
	</div>
</header>


  <!-- Main Content -->
  <div class="main-content">
      <div class="blog-header">
  

  <p><span class="date">09.16.2011</span>
  
    
      
    
      
    
      
    
      
        <a class="topic" href="/blog/topic/technology">Technology and Innovation</a>
      
    
  
  </p>

  <h1 class="post-title">A mime is a terrible thing to waste</h1>
  <p class="byline">
    
    
    
    
    
    
    
    
    
    
    
    
    <img class="team-photo" src="/assets/images/team/small/brandon.jpg">
    
      <strong>Brandon Lee</strong>
    <br>
      Senior Engineer
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
  </p>
</div>





<section class="body">
  <p>One of the first projects I am working on here at ThinkShout requires full-text search of file attachments. This is accomplished using the <a href="http://drupal.org/project/apachesolr_attachments">Apache Solr Attachments</a> module. We’re also using the <a href="http://drupal.org/project/facetapi">Facet API</a> module to allow the users to filter their searches based on certain criteria or “facets”.  The Facet API module provides several useful facets out-of-the-box, such as a filter by Author and by Content Type. One facet that we wanted to enable for the client’s users is the ability to filter on the type of file(s) attached to a node. The Facet API module allows a developer to create filter blocks based on fields indexed by <a href="http://drupal.org/project/apachesolr">Apache Solr Search Integration</a> (or in this case using Acquia Search with <a href="http://drupal.org/project/acquia_connector">Acquia Network Connector</a>).  The Apache Solr Attachments module provides the mimetype of the attached file as a piece of indexed data. Creating a facet is implemented with hook_facetapi_facet_info. Following the examples implemented for the default facets that ship with the module, a facet for mime type can be created by searching on the ss_filemime index field.</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>function MYMODULE_facetapi_facet_info($searcher_info) {
  $facets = array();
  
  $facets['mime'] = array(
     'label' =&gt; t('Mime Type'),
     'description' =&gt; t('Filter by mime type.'),
     //indexed field from solr 
     'field' =&gt; 'ss_filemime',
     'map callback' =&gt; 'MYMODULE_map_mime',
     'facet mincount allowed' =&gt; TRUE,
     'dependency plugins' =&gt; array('bundle', 'role'),
   );
   
  return $facets;
}
</code></pre></div></div>
<p>This can be done for any indexed field. Once the facet is implemented it can then be enabled through the admin screen for facets, which then, in turn, provides a block for that facet. The only issue we then faced was translating the presented mime types in a human-readable format. This is done with the map callback. The map callback is a function that takes the values of the index field that can then be associated with other content. In the case of the default Author facet the uid of the content is returned. The map callback for that facet is associated with the Drupal user and returns the username. For file mime types, a simple array of mime type to readable file type was used, so that, for example, “application/vnd.ms-excel” is just returned as “Excel”.</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>function MYMODULE_map_mime(array $values) {
  $map = $values;
  $mimes = array(
    'application/pdf'=&gt;'PDF',
    'application/msword'=&gt;'Word Document',
    'application/vnd.ms-excel'=&gt;'Excel',
  );
  $map = array();
  foreach ($mimes  as $type =&gt; $name) {
    $map[$type] = $name;
  }
  return $map;
}
</code></pre></div></div>


  
    
      <div class="blog-cta">
        <div class="text">
          <h3>Get In Touch</h3>
          <p><p>Questions? Comments? We want to know! Drop us a line and let’s start talking.</p>
</p>
          <a href="https://thinkshout.com/contact/" class="uppercase-link">Learn More<i class="fa fa-caret-right"></i></a>
        </div>

        
        <div class="image">
          <img src="/assets/images/ts_redesign/cta/portland-waterfront-cta.jpg" alt="Get In Touch">
        </div>
        
      </div>
      

  
    <div class="tags">
      <span class="tag-label">Tags:</span>
      <a class='tag' rel='tag category' title='View all posts tagged Apache Solr.' href='/blog/category/apache-solr/'>Apache Solr</a> <a class='tag' rel='tag category' title='View all posts tagged Drupal Planet.' href='/blog/category/drupal-planet/'>Drupal Planet</a> <a class='tag' rel='tag category' title='View all posts tagged Facet API.' href='/blog/category/facet-api/'>Facet API</a>
    </div>
  


  
<div class="comments">
  <div id="disqus_thread"></div>
  <script>
  /**
  * RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
  * LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables
  */
  var disqus_config = function () {
    this.page.url = 'https://thinkshout.com/blog/2011/09/brandon/mime-terrible-thing-waste/';
    this.page.identifier = '/blog/2011/09/brandon/a-mime-is-a-terrible-thing-to-waste';
    this.page.title = 'A mime is a terrible thing to waste'
  };
  (function() { // DON'T EDIT BELOW THIS LINE
  var d = document, s = d.createElement('script');

  s.src = '//thinkshout.disqus.com/embed.js';

  s.setAttribute('data-timestamp', +new Date());
  (d.head || d.body).appendChild(s);
  })();
  </script>
  <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
</div>


</section>

<div class="pagination">
  
    <div class="previous">
      <a href="/blog/2011/09/lev/openlayers-love-drupal-7/"><span class="fa fa-caret-left"></span> <span>OpenLayers Love for Drupal 7</span></a>
    </div>
  

  
    <div class="next">
      <a href="/blog/2011/10/sean/thinkshout-under-hood-years-pacific-northwest-drupal-summit/"><span>ThinkShout "Under the hood" at this year's Pacific Northwest Drupal Summit</span> <span class="fa fa-caret-right"></span></a>
    </div>
  
</div>




  <div class="team-member-blog">
    <div class="container">
      <h4>Related Blog Posts</h4>
      <div class="row posts">
        
        
        
        
        
          <div class="post">
  <a href="/blog/2018/05/Space-for-Empathy/">
    <p class="post-date">05.24.2018</p>
    <h3 class="post-title">Space for Empathy</h3>
    <p class="post-short">How do we make space for empathy in our work and in our community? Jules takes us on a deep dive into what she learned at this year's DrupalCon</p>
    <p class="byline">
      
      <img class="team-photo" src="/assets/images/team/small/jules.jpg">
      <span class="byline-text">
        <strong>Jules Dickey</strong><br>
        <span class="position">Software Engineer</span>
      </span>
    </p>
  </a>
</div>

          
          
        
        
        
          <div class="post">
  <a href="/blog/2018/05/Making-GDPR-Preparations/">
    <p class="post-date">05.13.2018</p>
    <h3 class="post-title">Preparing for the GDPR</h3>
    <p class="post-short">The European Union’s General Data Protection Regulations go into effect May 25th. Here's how you need to prepare.</p>
    <p class="byline">
      
      <img class="team-photo" src="/assets/images/team/small/tauno.jpg">
      <span class="byline-text">
        <strong>Tauno Hogue</strong><br>
        <span class="position">Chief Technology Officer</span>
      </span>
    </p>
  </a>
</div>

          
          
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
          <div class="post">
  <a href="/blog/2018/01/Great-hoodie-mystery/">
    <p class="post-date">01.06.2018</p>
    <h3 class="post-title">The Great Hoodie Mystery</h3>
    <p class="post-short">Gabe takes what would otherwise be an inane office exchange and ties it back to data structures.</p>
    <p class="byline">
      
      <img class="team-photo" src="/assets/images/team/small/gabe.jpg">
      <span class="byline-text">
        <strong>Gabe Carleton-Barnes</strong><br>
        <span class="position">Director of Engineering</span>
      </span>
    </p>
  </a>
</div>

          
          
            
      </div>
    </div>
  </div>


  </div>

  <!-- Footer -->
  <div class="newsletter-block">
  <div class="container">
    <div class="newsletter-info">
      <h1>Get Our Email Newsletter</h1>
      <p>
        Cutting edge solutions, strategies, and updates from industry
        thought-leaders, delivered right to your inbox.
      </p>

      <form id="mc-embedded-subscribe-form" action="//thinkshout.us1.list-manage.com/subscribe/post?u=2ec82d6db8eeef3d5b33b762e&amp;id=e85720354e" method="post"  name="mc-embedded-subscribe-form" class="validate" target="_blank">
        <input type="email" placeholder="your email address" name="EMAIL" id="mce-EMAIL" required>
        <button type="submit">submit<i class="fa fa-caret-right"></i></button>
      </form>
    </div>
  </div>
</div>

  <footer>
  <div class="container">
  	<nav class="footer-menu">
      <ul class="main-menu-footer">
        
        <li>
          <a href="/work/">Our Work</a>
          
        </li>
        
        <li>
          <a href="/services/">Services</a>
          
            <ul class="footer-submenu">
            
              <li>
                <a href="/services/digital-strategy/">Digital Strategy</a>
              </li>
            
              <li>
                <a href="/services/design/">Design & UX</a>
              </li>
            
              <li>
                <a href="/services/digital-ecosystem/">Digital Ecosystem</a>
              </li>
            
              <li>
                <a href="/services/development/">Development</a>
              </li>
            
            </ul>
          
        </li>
        
        <li>
          <a href="/values/">Values</a>
          
        </li>
        
        <li>
          <a href="/team/">Team</a>
          
        </li>
        
        <li>
          <a href="/blog/">Blog</a>
          
        </li>
        
        <li>
          <a href="/contact/">Connect With Us</a>
          
        </li>
        
        <li>
          <a href="/careers/">Careers</a>
          
        </li>
        
      </ul>
  	</nav>

    <div class="bcorp-logo">
      
      
        
          <a href="https://www.bcorporation.net/community/thinkshout-inc" target="_blank">
            <img src="/assets/images/ts_redesign/bcorp.png" alt="bcorp logo" />
          </a>
        
      
    </div>

    <div class="footer-bottom">
      <div class="social-media">
        <ul>
          
            <li>
              <a href="http://www.facebook.com/ThinkShout" target="_blank">
                <img src="/assets/images/ts_redesign/facebook.svg" alt="facebook" />
              </a>
            </li>
          
            <li>
              <a href="http://www.twitter.com/ThinkShout" target="_blank">
                <img src="/assets/images/ts_redesign/twitter.svg" alt="twitter" />
              </a>
            </li>
          
        </ul>
      </div>
      <div class="copyright">
        &copy;2018 ThinkShout, Inc. ThinkShout and the ThinkShout logos are registered trademarks of ThinkShout, Inc.
        
        
          
            <a href="/privacy/">Privacy Policy</a>
          
        
      </div>
    </div>
  </div>
</footer>


  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.0.0-beta1/jquery.min.js"></script>
	<script src="/assets/js/jquery.waypoints.min.js"></script>
  <script src="/assets/js/jquery.matchHeight.js"></script>
  <script src="/assets/js/chosen.jquery.min.js"></script>
  <script src="/assets/js/script.js"></script>


  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-9743130-1', 'auto');
    ga('send', 'pageview');

  </script>

</body>
</html>
