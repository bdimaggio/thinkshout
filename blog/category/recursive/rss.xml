<?xml version="1.0" encoding="UTF-8"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>ThinkShout</title>
    <description>ThinkShout - We provide web strategy and open source technology to forward-thinking organizations.</description>
    <link>https://thinkshout.com</link>
    <atom:link href="https://thinkshout.com/blog/category/recursive/rss.xml/rss.xml" rel="self" type="application/rss+xml"/>

    
      <item>
  <title>Creating Dynamic Menus in Jekyll</title>
  <description>
    <![CDATA[<p>When thinking about the “pros” of using a CMS, the robust menu system that is provided “out of the box” is usually at the top of the list. That said, when we decided to use Jekyll to build a production quality site for <a href="http://www.feedingtexas.org/">Feeding Texas</a> we knew creating a content manager-friendly menu system was a must.</p>

<p>There were many challenges in building a production-ready site in Jekyll, which I covered in my last blog post, <a href="http://thinkshout.com/blog/2014/10/success-building-cmsless-production-sites-with-jekyll">Success Building CMS-less Production Sites with Jekyll</a>, but the generation of a menu system that would make content management simple for end users was surprisingly vexing – mostly because this is taken for granted when using a CMS like Drupal.</p>

<p>As I embarked upon this task, my initial Googling surfaced several approaches for generating a structured menu in Jekyll, but none of them satisfied both of the criteria I had defined as necessary to make the menu system ready for a non-technical client to use easily:</p>

<ul>
  <li><strong>Recursive</strong> – I want my primary (header) and secondary (navigation) menu structure and the associated styling (e.g. active page underlined) to hold true regardless of where I am in the menu tree. This is useful when a landing page that is linked from the primary menu has several siblings you’d like to be able to page between via a secondary navigation menu. To visualize this, check out <a href="http://www.feedingtexas.org/about/">the Feeding Texas “About” page</a>.</li>
  <li><strong>Dynamic</strong> – when I add a page, I want the menu to be updated… automatically. This is helpful because all content managers need to do is create a new Markdown file and, voila! – a new menu item.</li>
</ul>

<h2 id="popular-approaches-and-why-they-fall-short">Popular Approaches and Why They Fall Short</h2>
<p>For both of the above criteria to be true, we cannot use either of the most popular Jekyll menu solutions I found on the web.</p>

<h3 id="data-driven-approach">Data-Driven Approach</h3>
<p>The data-driven approach I found to be popular [<a href="http://christianspecht.de/2014/06/18/building-a-pseudo-dynamic-tree-menu-with-jekyll/">1</a>,<a href="http://www.tournemille.com/blog/How-to-create-data-driven-navigation-in-Jekyll/">2</a>,<a href="https://github.com/Painted-Fox/jekyll-site-menus">3</a>] falls short because using a YML data file (e.g. <code class="highlighter-rouge">_data/menu.yml</code>) to scaffold the menu tree is not dynamic. At worst, the data file needs updating each time we add a page [<a href="http://www.tournemille.com/blog/How-to-create-data-driven-navigation-in-Jekyll/">2</a>] or, at best, when we add a new menu level [<a href="http://christianspecht.de/2014/06/18/building-a-pseudo-dynamic-tree-menu-with-jekyll/">1</a>].</p>

<h3 id="frontmatter-driven-approach">Frontmatter-Driven Approach</h3>
<p>Jekyll helpfully stores a <code class="highlighter-rouge">site.pages</code> variable that can be looped over in the following way to generate a list of all pages in the site.</p>

<p></p>
<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="nt">&lt;ul&gt;</span>
      {% for p in site.pages %}
        <span class="nt">&lt;li&gt;</span>
          <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"{{ p.url }}"</span><span class="nt">&gt;</span>{{ p.title }}<span class="nt">&lt;/a&gt;</span>
        <span class="nt">&lt;/li&gt;</span>
      {% endfor %}
    <span class="nt">&lt;/ul&gt;</span>
</code></pre></div></div>
<p></p>

<p>This technique is powerful, but limited. We certainly don’t get all we need without some more Liquid work.</p>

<p>For example if we wanted to style the active menu item, we could change the line outputting the link from the above snippet to…</p>

<p></p>
<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="nt">&lt;a</span> <span class="err">{%</span> <span class="na">if</span> <span class="na">p</span><span class="err">.</span><span class="na">url =</span><span class="s">=</span> <span class="na">page</span><span class="err">.</span><span class="na">url</span> <span class="err">%}</span><span class="na">class=</span><span class="s">"active"</span><span class="err">{%</span> <span class="na">endif</span> <span class="err">%}</span> <span class="na">href=</span><span class="s">"{{ p.url }}"</span><span class="nt">&gt;</span>{{ p.title }}<span class="nt">&lt;/a&gt;</span>
</code></pre></div></div>
<p></p>

<p>Here we make use of the <code class="highlighter-rouge">page.url</code> variable, which refers to the URL of the current page, to add special styling to the active menu item.</p>

<p>We could also add arbitrary frontmatter variables to all pages to achieve a number of different goals. For example, if we wanted to order the output of <code class="highlighter-rouge">site.pages</code> in some arbitrary way, we could add a <code class="highlighter-rouge">weight</code> frontmatter variable to each page and sort by said property before we start our loop.</p>

<p></p>
<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    {% assign pages = site.pages | sort:"weight"  %}
    {% for p in pages %}
      do something
    {% endfor %}
</code></pre></div></div>
<p></p>

<p>We could also group pages we wanted to appear in the same subnav (think back to Feeding Texas’ <a href="http://www.feedingtexas.org/about/">about</a> page linked above).</p>

<p></p>
<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    {% for p in site.pages %}
      {% if group == "group1" %}
        do something
      {% endif %}
    {% endfor %}
</code></pre></div></div>
<p></p>

<p>While powerful, these solutions require the maintenance of frontmatter variables among all pages on the site – something a content manager would like to avoid.</p>

<h2 id="the-solution-use-urls">The Solution: USE URLs!</h2>
<p>The fact that my initial Googling did not turn up any examples of folks leveraging URLs to generate menus shocked me. URLs are, after all, a machine readable representation of a menu tree!</p>

<p>Using the powerful <code class="highlighter-rouge">site.pages</code> variable and some fancy Liquid, I was able to achieve a no-maintenance solution for generating multi-level menus:</p>

<p></p>
<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{% assign url_parts = page.url | split: '/' %}
{% assign url_parts_size = url_parts | size %}
{% assign rm = url_parts | last %}
{% assign base_url = page.url | replace: rm %}

<span class="nt">&lt;ul&gt;</span>
{% for node in site.pages %}
  {% if node.url contains base_url %}
    {% assign node_url_parts = node.url | split: '/' %}
    {% assign node_url_parts_size = node_url_parts | size %}
    {% assign filename = node_url_parts | last %}
    {% if url_parts_size == node_url_parts_size and filename != 'index.html' %}
      <span class="nt">&lt;li&gt;&lt;a</span> <span class="na">href=</span><span class="s">'{{node.url}}'</span><span class="nt">&gt;</span>{{node.title}}<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
    {% endif %}
  {% endif %}
{% endfor %}
<span class="nt">&lt;/ul&gt;</span>
</code></pre></div></div>
<p></p>

<p>The code above is set up to be used as <a href="http://jekyllrb.com/docs/templates/#includes">an include</a>. Let’s walk through the file to get a better sense of what it’s doing…</p>

<p>First we need to get the URL of the current page so we know where we’re currently at in the menu tree.</p>

<p></p>
<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    {% assign url_parts = page.url | split: '/' %}
</code></pre></div></div>
<p></p>

<p>Here we are also splitting the URL into an array so we can ask additional questions like, “how many levels deep are we?”</p>

<p></p>
<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    {% assign url_parts_size = url_parts | size %}
</code></pre></div></div>
<p></p>

<p>Knowing the size of the array gives us our depth in the menu tree, which is helpful to render items at the same level of depth (again Feeding Texas’ <a href="http://www.feedingtexas.org/about/">about</a> page).</p>

<p>However, knowing our menu depth does not give us all we need to generate an appropriate subnav, as we likely do not want <em>all</em> pages the same depth, but rather pages at the same depth that share the same parent menu item.</p>

<p>For example, if we’re on the page generated by <code class="highlighter-rouge">hunger-atlas.md</code> we want our subnav to contain it and its <code class="highlighter-rouge">snapshot-texas.md</code> sibling.</p>

<p>Temp image: <img src="https://cloud.githubusercontent.com/assets/3582018/4709107/03dd7960-589d-11e4-8ecc-74d444e3a2f5.png" alt="menu-depth" /></p>

<p>This currently broken image will be used for the live post:<img src="http://thinkshout.com/assets/images/feeding-texas-menu-depth.png" alt="menu-depth" /></p>

<p>We don’t want <code class="highlighter-rouge">/news/blog/foo/index.html</code> although it’s at the same menu level as <code class="highlighter-rouge">/learn/communities/hunger-atlas/index.html</code>.</p>

<p>To accomplish this, we’ll generate a <code class="highlighter-rouge">base_url</code> to give us a relative sense of where we are in the menu tree.</p>

<p></p>
<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    {% assign rm = url_parts | last %}
    {% assign base_url = page.url | replace: rm %}
</code></pre></div></div>
<p></p>

<p>Note we’re removing the implicit <code class="highlighter-rouge">index.html</code> from the URL. This assumes we have not set a <a href="http://jekyllrb.com/docs/permalinks/">permalink</a> for the relevant pages.</p>

<p>Now we’re ready to start our loop through <code class="highlighter-rouge">site.pages</code>:</p>

<p></p>
<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="nt">&lt;ul&gt;</span>
    {% for node in site.pages %}
      {% if node.url contains base_url %}
        {% assign node_url_parts = node.url | split: '/' %}
        {% assign node_url_parts_size = node_url_parts | size %}
        {% assign filename = node_url_parts | last %}
        {% if url_parts_size == node_url_parts_size and filename != 'index.html' %}
          <span class="nt">&lt;li&gt;&lt;a</span> <span class="na">href=</span><span class="s">'{{node.url}}'</span><span class="nt">&gt;</span>{{node.title}}<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
        {% endif %}
      {% endif %}
    {% endfor %}
    <span class="nt">&lt;/ul&gt;</span>
</code></pre></div></div>
<p></p>

<p>In this loop we ask 3 things – all of which must be true to add a page to the subnav menu:</p>

<ol>
  <li>Does this page’s URL contain the <code class="highlighter-rouge">base_url</code>? This eliminates pages at the same menu depth, but with different parent items</li>
  <li>Is the page at the same menu depth as the page currently being viewed? This eliminates items below the current menu depth</li>
  <li>Is page’s filename <code class="highlighter-rouge">index.html</code>? This eliminates pages that should exist one level higher in the menu tree</li>
</ol>

<p>The last point requires a little explanation…</p>

<p>There are two ways of creating pages in Jekyll:</p>

<ul>
  <li><a href="http://jekyllrb.com/docs/pages/#named-html-files">Named HTML files</a></li>
  <li><a href="http://jekyllrb.com/docs/pages/#named-folders-containing-index-html-files">Named folders containing index HTML files</a></li>
</ul>

<p>If you’re using the former method, you don’t need to do check #3. I assumed the latter because it’s the more difficult menu generation scenario and many will opt for the clean URLs it produces.</p>

<p>In addition to clean URLs, using the “Named folders” method to create pages allows for implicit parent page detection. Adding a parent page link to the subnav improves the user experience by allowing users to descend and ascend the menu tree. Without a parent page link, if the user clicked a link that took them deeper down the menu tree, they would be presented with a different subnav than the previous page (remember, we only see subnav items at the current level of the menu tree) and have no way of getting back other than to use their browser’s “back” button.</p>

<p>Generating the parent page link is straightforward since you already have the <code class="highlighter-rouge">base_url</code> and know the name of the file will be <code class="highlighter-rouge">index.html</code>, so I’ll spare you the walkthrough.</p>

<h2 id="roundup">Roundup</h2>
<p>Although Jekyll is a static site generator, you have all you need when the site is being built to achieve dynamically generated menus without writing a custom plugin. Although it requires some legwork up front, this solution creates a CMS-like user experience for content managers without the performace overhead of the CMS.</p>

<p>That said, after building a dynamic menu system for a platform that does not include one, I’ll never take the ease and value of Drupal’s menu system for granted again.</p>

]]>
  </description>
  <pubDate>Tue, 02 Dec 2014 07:00:00 -0500</pubDate>
  <link>https://thinkshout.com/blog/2014/12/creating-dynamic-menus-in-jekyll/</link>
  <guid isPermaLink="true">https://thinkshout.com/blog/2014/12/creating-dynamic-menus-in-jekyll/</guid>
</item>

    

  </channel>
</rss>
